<app-loading [time]="2000" />

<app-toolbar />

<section class="body">
  <section class="container">
    <header class="header">
      <h3 class="text-center">Registrar Nueva Cuenta</h3>
    </header>

    <main class="row -g-3 justify-content-center">
      <div class="col-xxl-5 col-xl-5 col-lg-5 col-md-7 col-sm-10 col-11">
        <form autocomplete="off" enctype="multipart/form-data" [formGroup]="form" (submit)="guardarEmpresa()">

          <!-- Empresa -->
          <section class="empresa">
            <section class="header">
              <div class="d-flex justify-content-between align-self-center">
                <h4>Empresa</h4>
                <span class="align-self-center">
                  <i class="bi bi-caret-down-fill" (click)="desplegue($event)" data-bs-toggle="collapse" href="#empresa"
                    aria-expanded="true" aria-controls="empresa"></i>
                </span>
              </div>
            </section>
            <hr />
            <section class="content collapse show" id="empresa">

              <!-- Mensaje del archivo -->
              <div class="alert alert-warning d-flex align-items-center justify-content-center" role="alert">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <div>
                  El archivo a escoger debe pesar como 55kb para guardarlo como su logo personalizado de la empresa.
                </div>
              </div>

              <div class="text-center">

                <div class="d-block position-relative">

                  <div class="position-absolute top-0 end-0">
                    <div class="text-end reload me-3">
                      <i class="bi bi-arrow-clockwise" (click)=" reloadSeleccion()"></i>
                    </div>
                  </div>

                  <img class="rounded-circle border border-secondary" [ngSrc]="logoDefault" alt="Logo" width="150"
                    height="150" id="imagen_seleccionada" priority>
                </div>


                <button class="contenedor-btn-file bordeado my-3" type="button">
                  <i class="bi bi-cloud-arrow-up-fill"></i>
                  Seleccionar Archivo
                  <label for="logo"></label>
                  <!--<input type="hidden" id="logobase64" name="logobase64" value="{{logoNew}}" />-->
                  <input type="file" id="logo" name="logo" (change)="LeerArchivo($event)">
                </button>

              </div>

              <div class="mb-3">
                <label for="" class="form-label mb-1">Nombre de la Empresa</label>
                <input type="text" name="nombre_empresa" id="nombre_empresa"
                  class="form-control form-control-sm shadow-none" placeholder="Nombre de la Empresa ...."
                  formControlName="empresa" />

                <div class="d-flex flex-column">
                  @if(form.controls['empresa'].touched && form.controls['empresa'].invalid ||
                  form.controls['empresa'].dirty){
                  @if(form.controls['empresa'].errors?.['required']){
                  <small class="error"><i class="bi bi-bug-fill"></i> El nombre de la empresa es requerida.</small>
                  }

                  @if(form.controls['empresa'].errors?.['pattern']){
                  <small class="error"><i class="bi bi-bug-fill"></i> Solo se permite letras.</small>
                  }

                  @if(form.controls['empresa'].errors?.['maxlength']){
                  <small class="error"><i class="bi bi-bug-fill"></i> Solo se permite 30 letras.</small>
                  }
                  }
                </div>

              </div>

              <div class="mb-3">
                <label for="" class="form-label mb-1">Dirección</label>
                <input type="text" name="direccion_empresa" id="direccion_empresa"
                  class="form-control form-control-sm shadow-none" placeholder="Dirección ...."
                  formControlName="direccion_empresa" />

                <div class="d-flex flex-column">
                  @if(form.controls['direccion_empresa'].touched && form.controls['direccion_empresa'].invalid ||
                  form.controls['direccion_empresa'].dirty){
                  @if(form.controls['direccion_empresa'].errors?.['required']){
                  <small class="error"><i class="bi bi-bug-fill"></i> La dirección es requerida.</small>
                  }

                  @if(form.controls['direccion_empresa'].errors?.['maxlength']){
                  <small class="error"><i class="bi bi-bug-fill"></i> Solo se permite 30 letras.</small>
                  }
                  }
                </div>

              </div>

              <div class="mb-3">
                <label for="" class="form-label mb-1">Correo Electrónico</label>
                <input type="email" name="email_empresa" id="email_empresa"
                  class="form-control form-control-sm shadow-none" placeholder="Correo Electrónico ...."
                  formControlName="email_empresa" />

                <div class="d-flex flex-column ">
                  @if(form.controls['email_empresa'].touched && form.controls['email_empresa'].invalid ||
                  form.controls['email_empresa'].dirty){
                  @if(form.controls['email_empresa'].errors?.['required']){
                  <small class="error"><i class="bi bi-bug-fill"></i> El Correo Electrónico es requerido.</small>
                  }

                  @if(form.controls['email_empresa'].errors?.['maxlength']){
                  <small class="error"><i class="bi bi-bug-fill"></i> Solo se permite 200 letras.</small>
                  }

                  @if(form.controls['email_empresa'].errors?.['email'] ||
                  form.controls['email_empresa'].errors?.['pattern']){
                  <small class="error"><i class="bi bi-bug-fill"></i> No es un correo electrónico es invalido.</small>
                  }

                  }
                </div>

              </div>

              <div class="mb-3">
                <label for="" class="form-label mb-1">Descripción</label>
                <textarea class="form-control form-control-sm shadow-none" placeholder="Descripción ...."
                  formControlName="descripcion_empresa"></textarea>

                <div class="d-flex flex-column ">
                  @if(form.controls['descripcion_empresa'].touched && form.controls['descripcion_empresa'].invalid ||
                  form.controls['descripcion_empresa'].dirty){
                  @if(form.controls['descripcion_empresa'].errors?.['required']){
                  <small class="error"><i class="bi bi-bug-fill"></i> La descripción es requerida.</small>
                  }

                  @if(form.controls['descripcion_empresa'].errors?.['maxlength']){
                  <small class="error"><i class="bi bi-bug-fill"></i> Solo se permite 300 letras.</small>
                  }

                  }
                </div>
              </div>

              <div class="row g-2 justify-content-center">
                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                  <div class="mb-3">
                    <label for="" class="form-label mb-1">Telefono</label>
                    <input type="text" name="" id="" class="form-control form-control-sm shadow-none"
                      placeholder="999 999 999" mask="000 000 000" formControlName="telefono_empresa" />

                    <div class="d-flex flex-column ">
                      @if(form.controls['telefono_empresa'].touched && form.controls['telefono_empresa'].invalid
                      ||
                      form.controls['telefono_empresa'].dirty){
                      @if(form.controls['telefono_empresa'].errors?.['required']){
                      <small class="error"><i class="bi bi-bug-fill"></i> El telefono de la empresa es requerida.</small>
                      }

                      @if(form.controls['telefono_empresa'].errors?.['maxlength']){
                      <small class="error"><i class="bi bi-bug-fill"></i> Solo se permite 30 letras.</small>
                      }

                      }
                    </div>

                  </div>
                </div>
                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                  <div class="mb-3">
                    <label for="" class="form-label mb-1">Ruc</label>
                    <input type="text" name="" id="" class="form-control form-control-sm shadow-none"
                      placeholder="Ruc ...." formControlName="rul_empresa" />
                  </div>
                </div>
              </div>

            </section>
          </section>

          <!-- Propietario -->
          <section class="propietario">
            <section class="header">
              <div class="d-flex justify-content-between align-self-center">
                <h4>Propietario</h4>
                <span class="align-self-center">
                  <i class="bi bi-caret-up-fill" (click)="desplegue($event)" data-bs-toggle="collapse"
                    href="#propietario" aria-expanded="false" aria-controls="propietario"></i>
                </span>
              </div>
            </section>
            <hr />

            <section class="content collapse" id="propietario">
              <div class="row g-1 justify-content-start">
                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                  <div class="mb-3">
                    <label for="" class="form-label mb-1">Nombre</label>
                    <input type="text" name="nombre_propietario" id="nombre_propietario"
                      class="form-control form-control-sm shadow-none" placeholder="Nombre ...."
                      formControlName="nombre_propietario" />
                  </div>
                </div>
                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                  <div class="mb-3">
                    <label for="" class="form-label mb-1">Apellido</label>
                    <input type="text" name="apellido_propietario" id="apellido_propietario"
                      class="form-control form-control-sm shadow-none" placeholder="Apellido ...."
                      formControlName="apellido_propietario" />
                  </div>
                </div>

                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                  <div class="mb-3">
                    <label for="" class="form-label mb-1">Correo Electrónico</label>
                    <input type="email" name="email_propietario" id="email_propietario"
                      class="form-control form-control-sm shadow-none" placeholder="Correo Electrónico ...."
                      formControlName="email_propietario" />

                    <div class="d-flex flex-column ">
                      @if(form.controls['email_propietario'].touched && form.controls['email_propietario'].invalid ||
                      form.controls['email_propietario'].dirty){
                      @if(form.controls['email_propietario'].errors?.['required']){
                      <small class="error"><i class="bi bi-bug-fill"></i> El Correo Electrónico es requerido.</small>
                      }

                      @if(form.controls['email_propietario'].errors?.['maxlength']){
                      <small class="error"><i class="bi bi-bug-fill"></i> Solo se permite 200 letras.</small>
                      }

                      @if(form.controls['email_propietario'].errors?.['email'] ||
                      form.controls['email_propietario'].errors?.['pattern']){
                      <small class="error"><i class="bi bi-bug-fill"></i> No es un correo electrónico es
                        invalido.</small>
                      }

                      }
                    </div>
                  </div>
                </div>
                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                  <div class="mb-3">
                    <label for="" class="form-label mb-1">Contraseña</label>
                    <input type="password" name="password" id="password"
                      class="form-control form-control-sm shadow-none" placeholder="Contraseña ...."
                      formControlName="password_propietario" />
                  </div>
                </div>

                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                  <div class="mb-3">
                    <label for="" class="form-label mb-1">Sexo</label>
                    <select name="sexo" id="sexo" class="form-select form-select-sm shadow-none"
                      formControlName="sexo_propietario">
                      <option selected value="" disabled>.:: Selecciona el Sexo ::.</option>
                      <option value="H">Hombre</option>
                      <option value="M">Mujer</option>
                    </select>
                  </div>
                </div>
                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                  <div class="mb-3">
                    <label for="" class="form-label mb-1">Telefono y/o Celular</label>
                    <input type="text" name="celular" id="celular" class="form-control form-control-sm shadow-none"
                      placeholder="000 000 000" mask="000 000 000" formControlName="telefono_propietario" />
                  </div>
                </div>

                <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                  <div class="mb-3">
                    <label for="" class="form-label mb-1">N° de Documento</label>
                    <input type="text" name="dni" id="dni" class="form-control form-control-sm shadow-none"
                      placeholder="00000000" mask="00000000" formControlName="dni_propietario" />
                  </div>
                </div>

              </div>
            </section>
          </section>

          <!-- Redes Sociales -->
          <section class="redes-sociales">
            <section class="header">
              <div class="d-flex justify-content-between align-self-center">
                <h4>Redes Sociales</h4>
                <span (click)="addRedesSociales()" class="align-self-center">
                  <i class="bi bi-plus-lg"></i>
                </span>
              </div>
            </section>

            <hr />

            <section class="content">

              <div class="add-lessons-form" [formGroup]="form">

                <div formArrayName="sociales">
                  @for (redes of redesSociales.controls; track redes; let i = $index) {

                  <div [formGroupName]="i">
                    <div class="d-flex justify-content-between mt-2">
                      <div class="d-flex">

                        <!-- Redes Sociales -->
                        @for (item of listredSocial; track item.idRedes) {
                        <div class="form-check me-3 align-self-center">
                          <input class="form-check-input shadow-none" type="radio" formControlName="social"
                            value="{{item.idRedes}}" id="social{{i}}">

                          <i class="{{item.logo}}"></i>
                        </div>
                        }

                      </div>

                      <span (click)="deleteRedesSociales(i)" class="align-self-center">
                        <i class="bi bi-trash3"></i>
                      </span>

                    </div>

                    <div class="w-100">
                      <input type="text" class="form-control form-control-sm shadow-none"
                        placeholder="Ingrese la dirección de la red social." name="descripcion" id="descripcion"
                        formControlName="descripcion" />
                    </div>

                    @if (redes.get('descripcion')?.invalid && redes.get('descripcion')?.touched ||
                    redes.get('descripcion')?.dirty ) {

                    @if (redes.get('descripcion')?.errors?.['required'] ) {
                    <small class="error"><i class="bi bi-bug-fill"></i> Debes seleccionar e ingresar el link de la red
                      social.</small>
                    }

                    }
                  </div>

                  }
                </div>

              </div>
            </section>
          </section>

          <footer class="text-end">
            <button type="submit" class="btn btn-primary registro-empresa" [disabled]="!form.valid">
              <small><i class="bi bi-floppy-fill"></i> Crear
                Empresa</small></button>
          </footer>
        </form>

      </div>
    </main>

    <footer>

    </footer>

  </section>
</section>
